var kLt=Object.create,IW=Object.defineProperty,ILt=Object.getOwnPropertyDescriptor,TLt=Object.getOwnPropertyNames,DLt=Object.getPrototypeOf,RLt=Object.prototype.hasOwnProperty,$o=(e,t)=>()=>t=e?e(e=0):t,O=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),eS=(e,t)=>{for(var r in t)IW(e,r,{get:t[r],enumerable:!0})},M7e=(t,r,a,s)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let e of TLt(r))RLt.call(t,e)||e===a||IW(t,e,{get:()=>r[e],enumerable:!(s=ILt(r,e))||s.enumerable});return t},Ae=(e,t,r)=>(r=null!=e?kLt(DLt(e)):{},M7e(!t&&e&&e.__esModule?r:IW(r,"default",{value:e,enumerable:!0}),e)),Qo=e=>M7e(IW({},"__esModule",{value:!0}),e),nh=O((e,t)=>{t.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}}),Bte=O((e,t)=>{var r="object"==typeof global&&global&&global.Object===Object&&global;t.exports=r}),sp=O((e,t)=>{var r=Bte(),a="object"==typeof self&&self&&self.Object===Object&&self,r=r||a||Function("return this")();t.exports=r}),sEe=O((e,t)=>{var r=sp();t.exports=function(){return r.Date.now()}}),aEe=O((e,t)=>{var r=/\s/;t.exports=function(e){for(var t=e.length;t--&&r.test(e.charAt(t)););return t}}),cEe=O((e,t)=>{var r=aEe(),a=/^\s+/;t.exports=function(e){return e&&e.slice(0,r(e)+1).replace(a,"")}}),Vv=O((e,t)=>{var r=sp().Symbol;t.exports=r}),fEe=O((e,t)=>{var r=Vv(),a=Object.prototype,i=a.hasOwnProperty,n=a.toString,o=r?r.toStringTag:void 0;t.exports=function(e){var t=i.call(e,o),r=e[o];try{var a=!(e[o]=void 0)}catch{}var s=n.call(e);return a&&(t?e[o]=r:delete e[o]),s}}),gEe=O((e,t)=>{var r=Object.prototype.toString;t.exports=function(e){return r.call(e)}}),M_=O((e,t)=>{var r=Vv(),a=fEe(),s=gEe(),i=r?r.toStringTag:void 0;t.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":(i&&i in Object(e)?a:s)(e)}}),sh=O((e,t)=>{t.exports=function(e){return null!=e&&"object"==typeof e}}),yEe=O((e,t)=>{var r=M_(),a=sh();t.exports=function(e){return"symbol"==typeof e||a(e)&&"[object Symbol]"==r(e)}}),SEe=O((e,t)=>{var r=cEe(),a=nh(),s=yEe(),i=/^[-+]0x[0-9a-f]+$/i,n=/^0b[01]+$/i,o=/^0o[0-7]+$/i,l=parseInt;t.exports=function(e){if("number"==typeof e)return e;if(s(e))return NaN;if(a(e)&&(t="function"==typeof e.valueOf?e.valueOf():e,e=a(t)?t+"":t),"string"!=typeof e)return 0===e?e:+e;e=r(e);var t=n.test(e);return t||o.test(e)?l(e.slice(2),t?2:8):i.test(e)?NaN:+e}}),Hv=O((e,t)=>{var A=nh(),v=sEe(),y=SEe(),b=Math.max,w=Math.min;t.exports=function(a,r,e){var s,i,n,o,l,c,p=0,u=!1,d=!1,t=!0;if("function"!=typeof a)throw new TypeError("Expected a function");function h(e){var t=s,r=i;return s=i=void 0,p=e,o=a.apply(r,t)}function f(e){var t=e-c;return void 0===c||r<=t||t<0||d&&n<=e-p}function g(){var e,t=v();if(f(t))return m(t);l=setTimeout(g,(e=r-((t=t)-c),d?w(e,n-(t-p)):e))}function m(e){return l=void 0,t&&s?h(e):(s=i=void 0,o)}function _(){var e=v(),t=f(e);if(s=arguments,i=this,c=e,t){if(void 0===l)return p=e=c,l=setTimeout(g,r),u?h(e):o;if(d)return clearTimeout(l),l=setTimeout(g,r),h(c)}return void 0===l&&(l=setTimeout(g,r)),o}return r=y(r)||0,A(e)&&(u=!!e.leading,d="maxWait"in e,n=d?b(y(e.maxWait)||0,r):n,t="trailing"in e?!!e.trailing:t),_.cancel=function(){void 0!==l&&clearTimeout(l),s=c=i=l=void(p=0)},_.flush=function(){return void 0===l?o:m(v())},_}}),y3=O((e,t)=>{var i=Hv(),n=nh();t.exports=function(e,t,r){var a=!0,s=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return n(r)&&(a="leading"in r?!!r.leading:a,s="trailing"in r?!!r.trailing:s),i(e,t,{leading:a,maxWait:t,trailing:s})}});function uS(){return $W>QW.length-16&&(NEe.default.randomFillSync(QW),$W=0),QW.slice($W,$W+=16)}var NEe,QW,$W,Hte=$o(()=>{NEe=Ae(require("crypto")),QW=new Uint8Array(256),$W=QW.length}),PEe,$Ee=$o(()=>{PEe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i});function jOt(e){return"string"==typeof e&&PEe.test(e)}var ih,dS=$o(()=>{$Ee(),ih=jOt});function N_(e,t=0){return xc[e[t+0]]+xc[e[t+1]]+xc[e[t+2]]+xc[e[t+3]]+"-"+xc[e[t+4]]+xc[e[t+5]]+"-"+xc[e[t+6]]+xc[e[t+7]]+"-"+xc[e[t+8]]+xc[e[t+9]]+"-"+xc[e[t+10]]+xc[e[t+11]]+xc[e[t+12]]+xc[e[t+13]]+xc[e[t+14]]+xc[e[t+15]]}function KOt(e,t=0){e=N_(e,t);if(ih(e))return e;throw TypeError("Stringified UUID is invalid")}var xc,QEe,pS=$o(()=>{dS(),xc=[];for(let e=0;e<256;++e)xc.push((e+256).toString(16).slice(1));QEe=KOt});function JOt(e,t,r){var a=t&&r||0,s=t||new Array(16);let i=(e=e||{}).node||qEe,n=void 0!==e.clockseq?e.clockseq:Gte,o=(null!=i&&null!=n||(r=e.random||(e.rng||uS)(),null==i&&(i=qEe=[1|r[0],r[1],r[2],r[3],r[4],r[5]]),null==n&&(n=Gte=16383&(r[6]<<8|r[7]))),void 0!==e.msecs?e.msecs:Date.now()),l=void 0!==e.nsecs?e.nsecs:Kte+1,c=o-jte+(l-Kte)/1e4;if(c<0&&void 0===e.clockseq&&(n=n+1&16383),1e4<=(l=(c<0||jte<o)&&void 0===e.nsecs?0:l))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");jte=o,Kte=l,Gte=n;r=(1e4*(268435455&(o+=122192928e5))+l)%4294967296,s[a++]=r>>>24&255,s[a++]=r>>>16&255,s[a++]=r>>>8&255,s[a++]=255&r,e=o/4294967296*1e4&268435455;s[a++]=e>>>8&255,s[a++]=255&e,s[a++]=e>>>24&15|16,s[a++]=e>>>16&255,s[a++]=n>>>8|128,s[a++]=255&n;for(let e=0;e<6;++e)s[a+e]=i[e];return t||N_(s)}var qEe,Gte,jte,Kte,UEe,VEe=$o(()=>{Hte(),pS(),Kte=jte=0,UEe=JOt});function XOt(e){var t,r;if(ih(e))return(r=new Uint8Array(16))[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r;throw TypeError("Invalid UUID")}var qW,Jte=$o(()=>{dS(),qW=XOt});function ZOt(t){t=unescape(encodeURIComponent(t));var r=[];for(let e=0;e<t.length;++e)r.push(t.charCodeAt(e));return r}function fS(e,n,o){function t(e,t,r,a){var s;if("string"==typeof e&&(e=ZOt(e)),16!==(null==(s=t="string"==typeof t?qW(t):t)?void 0:s.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let i=new Uint8Array(16+e.length);if(i.set(t),i.set(e,t.length),(i=o(i))[6]=15&i[6]|n,i[8]=63&i[8]|128,r){a=a||0;for(let e=0;e<16;++e)r[a+e]=i[e];return r}return N_(i)}try{t.name=e}catch{}return t.DNS=eWt,t.URL=tWt,t}var eWt,tWt,Xte=$o(()=>{pS(),Jte(),eWt="6ba7b810-9dad-11d1-80b4-00c04fd430c8",tWt="6ba7b811-9dad-11d1-80b4-00c04fd430c8"});function rWt(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),HEe.default.createHash("md5").update(e).digest()}var HEe,GEe,jEe=$o(()=>{HEe=Ae(require("crypto")),GEe=rWt}),nWt,KEe,JEe=$o(()=>{Xte(),jEe(),nWt=fS("v3",48,GEe),KEe=nWt}),XEe,Zte,ZEe=$o(()=>{XEe=Ae(require("crypto")),Zte={randomUUID:XEe.default.randomUUID}});function sWt(e,t,r){if(Zte.randomUUID&&!t&&!e)return Zte.randomUUID();var a=(e=e||{}).random||(e.rng||uS)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=a[e];return t}return N_(a)}var jv,ewe=$o(()=>{ZEe(),Hte(),pS(),jv=sWt});function iWt(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),twe.default.createHash("sha1").update(e).digest()}var twe,rwe,nwe=$o(()=>{twe=Ae(require("crypto")),rwe=iWt}),aWt,swe,iwe=$o(()=>{Xte(),nwe(),aWt=fS("v5",80,rwe),swe=aWt}),awe,owe=$o(()=>{awe="00000000-0000-0000-0000-000000000000"});function oWt(e){if(ih(e))return parseInt(e.slice(14,15),16);throw TypeError("Invalid UUID")}var cwe,lwe=$o(()=>{dS(),cwe=oWt}),uwe={},UW=(eS(uwe,{NIL:()=>awe,parse:()=>qW,stringify:()=>QEe,v1:()=>UEe,v3:()=>KEe,v4:()=>jv,v5:()=>swe,validate:()=>ih,version:()=>cwe}),$o(()=>{VEe(),JEe(),ewe(),iwe(),owe(),lwe(),dS(),pS(),Jte()})),pwe=O((e,t)=>{function r(e,t){if(!(e&&t&&e.length&&t.length))throw new Error("Bad alphabet");this.srcAlphabet=e,this.dstAlphabet=t}r.prototype.convert=function(e){var t,r,a,s={},i=this.srcAlphabet.length,n=this.dstAlphabet.length,o=e.length,l="string"==typeof e?"":[];if(!this.isValid(e))throw new Error('Number "'+e+'" contains of non-alphabetic digits ('+this.srcAlphabet+")");if(this.srcAlphabet===this.dstAlphabet)return e;for(t=0;t<o;t++)s[t]=this.srcAlphabet.indexOf(e[t]);do{for(t=a=r=0;t<o;t++)n<=(r=r*i+s[t])?(s[a++]=parseInt(r/n,10),r%=n):0<a&&(s[a++]=0)}while(o=a,l=this.dstAlphabet.slice(r,r+1).concat(l),0!==a);return l},r.prototype.isValid=function(e){for(var t=0;t<e.length;++t)if(-1===this.srcAlphabet.indexOf(e[t]))return!1;return!0},t.exports=r}),hwe=O((e,t)=>{var a=pwe();function r(e,t){var r=new a(e,t);return function(e){return r.convert(e)}}r.BIN="01",r.OCT="01234567",r.DEC="0123456789",r.HEX="0123456789abcdef",t.exports=r}),Awe=O((e,t)=>{UW();var r,{v4:p,validate:u}=Qo(uwe),d=hwe(),h={cookieBase90:"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!#$%&'()*+-./:<=>?@[]^_`{|}~",flickrBase58:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ",uuid25Base36:"0123456789abcdefghijklmnopqrstuvwxyz"},f={consistentLength:!0},g=(e,t,r)=>{t=t(e.toLowerCase().replace(/-/g,""));return r&&r.consistentLength?t.padStart(r.shortIdLength,r.paddingChar):t},m=(e,t)=>{t=t(e).padStart(32,"0").match(/(\w{8})(\w{4})(\w{4})(\w{4})(\w{12})/);return[t[1],t[2],t[3],t[4],t[5]].join("-")};t.exports=(()=>{let e=(e,t)=>{let s=e||h.flickrBase58,i={...f,...t};if([...new Set(Array.from(s))].length!==s.length)throw new Error("The provided Alphabet has duplicate characters resulting in unreliable results");e=s.length;let n=Math.ceil(Math.log(2**128)/Math.log(e)),r={shortIdLength:n,consistentLength:i.consistentLength,paddingChar:s[0]},a=d(d.HEX,s),o=d(s,d.HEX),l=()=>g(p(),a,r),c={alphabet:s,fromUUID:e=>g(e,a,r),maxLength:n,generate:l,new:l,toUUID:e=>m(e,o),uuid:p,validate:(e,t=!1)=>{var r,a;return!(!e||"string"!=typeof e)&&(r=i.consistentLength?e.length===n:e.length<=n,a=e.split("").every(e=>s.includes(e)),!1===t?r&&a:r&&a&&u(m(e,o)))}};return Object.freeze(c),c};return e.constants=h,e.uuid=p,e.generate=()=>(r=r||e(h.flickrBase58).generate)(),e})()}),Jl={};function Bwe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}are(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function zwe(e,t){var r={};for(s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(r[s[a]]=e[s[a]]);return r}function Fwe(e,t,r,a){var s,i=arguments.length,n=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,a);else for(var o=e.length-1;0<=o;o--)(s=e[o])&&(n=(i<3?s(n):3<i?s(t,r,n):s(t,r))||n);return 3<i&&n&&Object.defineProperty(t,r,n),n}function Mwe(r,a){return function(e,t){a(e,t,r)}}function bWt(e,t,r,a,s,i){function n(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,l=a.kind,c="getter"===l?"get":"setter"===l?"set":"value",e=!t&&e?a.static?e:e.prototype:null,p=t||(e?Object.getOwnPropertyDescriptor(e,a.name):{}),u=!1,d=r.length-1;0<=d;d--){var h,f={};for(h in a)f[h]="access"===h?{}:a[h];for(h in a.access)f.access[h]=a.access[h];f.addInitializer=function(e){if(u)throw new TypeError("Cannot add initializers after decoration has completed");i.push(n(e||null))};var g=(0,r[d])("accessor"===l?{get:p.get,set:p.set}:p[c],f);if("accessor"===l){if(void 0!==g){if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(o=n(g.get))&&(p.get=o),(o=n(g.set))&&(p.set=o),(o=n(g.init))&&s.unshift(o)}}else(o=n(g))&&("field"===l?s.unshift(o):p[c]=o)}e&&Object.defineProperty(e,a.name,p),u=!0}function vWt(e,t,r){for(var a=2<arguments.length,s=0;s<t.length;s++)r=a?t[s].call(e,r):t[s].call(e);return a?r:void 0}function yWt(e){return"symbol"==typeof e?e:"".concat(e)}function EWt(e,t,r){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function Ywe(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function Nwe(e,n,o,l){return new(o=o||Promise)(function(r,t){function a(e){try{i(l.next(e))}catch(e){t(e)}}function s(e){try{i(l.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(a,s)}i((l=l.apply(e,n||[])).next())})}function Pwe(a,s){var i,n,o,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function e(r){return function(e){var t=[r,e];if(i)throw new TypeError("Generator is already executing.");for(;l=c&&t[c=0]?0:l;)try{if(i=1,n&&(o=2&t[0]?n.return:t[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,t[1])).done)return o;switch(n=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,n=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(o=0<(o=l.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3]))l.label=t[1];else if(6===t[0]&&l.label<o[1])l.label=o[1],o=t;else{if(!(o&&l.label<o[2])){o[2]&&l.ops.pop(),l.trys.pop();continue}l.label=o[2],l.ops.push(t)}}t=s.call(a,l)}catch(e){t=[6,e],n=0}finally{i=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}function $we(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||eB(t,e,r)}function ZW(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],a=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&a>=e.length?void 0:e)&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ore(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var a,s,i=r.call(e),n=[];try{for(;(void 0===t||0<t--)&&!(a=i.next()).done;)n.push(a.value)}catch(e){s={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(s)throw s.error}}return n}function Qwe(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(ore(arguments[t]));return e}function qwe(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var a=Array(e),s=0,t=0;t<r;t++)for(var i=arguments[t],n=0,o=i.length;n<o;n++,s++)a[s]=i[n];return a}function Uwe(e,t,r){if(r||2===arguments.length)for(var a,s=0,i=t.length;s<i;s++)!a&&s in t||((a=a||Array.prototype.slice.call(t,0,s))[s]=t[s]);return e.concat(a||Array.prototype.slice.call(t))}function Xv(e){return this instanceof Xv?(this.v=e,this):new Xv(e)}function Vwe(e,t,r){var s,i,n;if(Symbol.asyncIterator)return s=r.apply(e,t||[]),i=[],n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;throw new TypeError("Symbol.asyncIterator is not defined.");function a(a){s[a]&&(n[a]=function(r){return new Promise(function(e,t){1<i.push([a,r,e,t])||o(a,r)})})}function o(e,t){try{(r=s[e](t)).value instanceof Xv?Promise.resolve(r.value.v).then(l,c):p(i[0][2],r)}catch(e){p(i[0][3],e)}var r}function l(e){o("next",e)}function c(e){o("throw",e)}function p(e,t){e(t),i.shift(),i.length&&o(i[0][0],i[0][1])}}function Hwe(a){var s,e={};return t("next"),t("throw",function(e){throw e}),t("return"),e[Symbol.iterator]=function(){return this},e;function t(t,r){e[t]=a[t]?function(e){return(s=!s)?{value:Xv(a[t](e)),done:!1}:r?r(e):e}:r}}function Gwe(n){var e,t;if(Symbol.asyncIterator)return(e=n[Symbol.asyncIterator])?e.call(n):(n="function"==typeof ZW?ZW(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);throw new TypeError("Symbol.asyncIterator is not defined.");function r(i){t[i]=n[i]&&function(s){return new Promise(function(e,t){var r,a;s=n[i](s),r=e,e=t,a=s.done,t=s.value,Promise.resolve(t).then(function(e){r({value:e,done:a})},e)})}}}function jwe(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function Kwe(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&eB(t,e,r);return wWt(t,e),t}function Jwe(e){return e&&e.__esModule?e:{default:e}}function Xwe(e,t,r,a){if("a"===r&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e===t&&a:t.has(e))return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e);throw new TypeError("Cannot read private member from an object whose class did not declare it")}function Zwe(e,t,r,a,s){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e===t&&s:t.has(e))return"a"===a?s.call(e,r):s?s.value=r:t.set(e,r),r;throw new TypeError("Cannot write private member to an object whose class did not declare it")}function eCe(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function tCe(e,t,r){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var a;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");a=t[Symbol.asyncDispose]}if(void 0===a){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");a=t[Symbol.dispose]}if("function"!=typeof a)throw new TypeError("Object not disposable.");e.stack.push({value:t,dispose:a,async:r})}else r&&e.stack.push({async:!0});return t}function rCe(a){function s(e){a.error=a.hasError?new CWt(e,a.error,"An error was suppressed during disposal."):e,a.hasError=!0}return function t(){for(;a.stack.length;){var e=a.stack.pop();try{var r=e.dispose&&e.dispose.call(e.value);if(e.async)return Promise.resolve(r).then(t,function(e){return s(e),t()})}catch(e){s(e)}}if(a.hasError)throw a.error}()}eS(Jl,{__addDisposableResource:()=>tCe,__assign:()=>XW,__asyncDelegator:()=>Hwe,__asyncGenerator:()=>Vwe,__asyncValues:()=>Gwe,__await:()=>Xv,__awaiter:()=>Nwe,__classPrivateFieldGet:()=>Xwe,__classPrivateFieldIn:()=>eCe,__classPrivateFieldSet:()=>Zwe,__createBinding:()=>eB,__decorate:()=>Fwe,__disposeResources:()=>rCe,__esDecorate:()=>bWt,__exportStar:()=>$we,__extends:()=>Bwe,__generator:()=>Pwe,__importDefault:()=>Jwe,__importStar:()=>Kwe,__makeTemplateObject:()=>jwe,__metadata:()=>Ywe,__param:()=>Mwe,__propKey:()=>yWt,__read:()=>ore,__rest:()=>zwe,__runInitializers:()=>vWt,__setFunctionName:()=>EWt,__spread:()=>Qwe,__spreadArray:()=>Uwe,__spreadArrays:()=>qwe,__values:()=>ZW,default:()=>SWt});var are,XW,eB,wWt,CWt,SWt,Xl=$o(()=>{are=function(e,t){return(are=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},XW=function(){return(XW=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},eB=Object.create?function(e,t,r,a){void 0===a&&(a=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&("get"in s?t.__esModule:!s.writable&&!s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,s)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]},wWt=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},CWt="function"==typeof SuppressedError?SuppressedError:function(e,t,r){r=new Error(r);return r.name="SuppressedError",r.error=e,r.suppressed=t,r},SWt={__extends:Bwe,__assign:XW,__rest:zwe,__decorate:Fwe,__param:Mwe,__metadata:Ywe,__awaiter:Nwe,__generator:Pwe,__createBinding:eB,__exportStar:$we,__values:ZW,__read:ore,__spread:Qwe,__spreadArrays:qwe,__spreadArray:Uwe,__await:Xv,__asyncGenerator:Vwe,__asyncDelegator:Hwe,__asyncValues:Gwe,__makeTemplateObject:jwe,__importStar:Kwe,__importDefault:Jwe,__classPrivateFieldGet:Xwe,__classPrivateFieldSet:Zwe,__classPrivateFieldIn:eCe,__addDisposableResource:tCe,__disposeResources:rCe}}),sCe=O(e=>{Object.defineProperty(e,"__esModule",{value:!0})}),aCe=O(e=>{Object.defineProperty(e,"__esModule",{value:!0})}),cre=O(e=>{Object.defineProperty(e,"__esModule",{value:!0})}),lre=O(e=>{e.dset=function(e,t,r){for(var a,s,i=0,n=(t=t.split?t.split("."):t).length,o=e;i<n&&"__proto__"!==(s=""+t[i++])&&"constructor"!==s&&"prototype"!==s;)o=o[s]=i===n?r:typeof(a=o[s])==typeof t?a:0*t[i]!=0||~(""+t[i]).indexOf(".")?{}:[]}}),lCe=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.pickBy=void 0;e.pickBy=function(r,t){return Object.keys(r).filter(function(e){return t(e,r[e])}).reduce(function(e,t){return e[t]=r[t],e},{})}}),ure=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ValidationError=void 0;Xl();var r,t=Qo(Jl),t=(r=Error,t.__extends(a,r),a);function a(e,t){t=r.call(this,"".concat(e," ").concat(t))||this;return t.field=e,t}e.ValidationError=t}),dre=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isPlainObject=e.exists=e.isFunction=e.isNumber=e.isString=void 0,e.isString=function(e){return"string"==typeof e},e.isNumber=function(e){return"number"==typeof e},e.isFunction=function(e){return"function"==typeof e},e.exists=function(e){return null!=e},e.isPlainObject=function(e){return"object"===Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}}),fre=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.validateEvent=e.assertMessageId=e.assertTraits=e.assertTrackEventProperties=e.assertTrackEventName=e.assertEventType=e.assertEventExists=e.assertUserIdentity=void 0;var a=ure(),s=dre(),i="is not a string",t="is not an object";function r(e){if(!(0,s.exists)(e))throw new a.ValidationError("Event","is nil");if("object"!=typeof e)throw new a.ValidationError("Event",t)}function n(e){if(!(0,s.isString)(e.type))throw new a.ValidationError(".type",i)}function o(e){if(!(0,s.isString)(e.event))throw new a.ValidationError(".event",i)}function l(e){if(!(0,s.isPlainObject)(e.properties))throw new a.ValidationError(".properties",t)}function c(e){if(!(0,s.isPlainObject)(e.traits))throw new a.ValidationError(".traits",t)}function p(e){if(!(0,s.isString)(e.messageId))throw new a.ValidationError(".messageId",i)}e.assertUserIdentity=function(e){var t=".userId/anonymousId/previousId/groupId",r=null!=(r=null!=(r=null!=(r=(e=e).userId)?r:e.anonymousId)?r:e.groupId)?r:e.previousId;if(!(0,s.exists)(r))throw new a.ValidationError(t,"is nil");if(!(0,s.isString)(r))throw new a.ValidationError(t,i)},e.assertEventExists=r,e.assertEventType=n,e.assertTrackEventName=o,e.assertTrackEventProperties=l,e.assertTraits=c,e.assertMessageId=p,e.validateEvent=function(e){r(e),n(e),p(e),"track"===e.type&&(o(e),l(e)),["group","identify"].includes(e.type)&&c(e)}}),ACe=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CoreEventFactory=void 0;Xl();var n=Qo(Jl),o=(n.__exportStar(cre(),e),lre()),l=lCe(),c=fre(),t=function(e){var t;this.settings=e,this.createMessageId=e.createMessageId,this.onEventMethodCall=null!=(t=e.onEventMethodCall)?t:function(){},this.onFinishedEvent=null!=(t=e.onFinishedEvent)?t:function(){}};function r(e){this.settings=new t(e)}r.prototype.track=function(e,t,r,a){return this.settings.onEventMethodCall({type:"track",options:r}),this.normalize(n.__assign(n.__assign({},this.baseEvent()),{event:e,type:"track",properties:t??{},options:n.__assign({},r),integrations:n.__assign({},a)}))},r.prototype.page=function(e,t,r,a,s){this.settings.onEventMethodCall({type:"page",options:a});r={type:"page",properties:n.__assign({},r),options:n.__assign({},a),integrations:n.__assign({},s)};return null!==e&&(r.category=e,r.properties=null!=(a=r.properties)?a:{},r.properties.category=e),null!==t&&(r.name=t),this.normalize(n.__assign(n.__assign({},this.baseEvent()),r))},r.prototype.screen=function(e,t,r,a,s){this.settings.onEventMethodCall({type:"screen",options:a});r={type:"screen",properties:n.__assign({},r),options:n.__assign({},a),integrations:n.__assign({},s)};return null!==e&&(r.category=e),null!==t&&(r.name=t),this.normalize(n.__assign(n.__assign({},this.baseEvent()),r))},r.prototype.identify=function(e,t,r,a){return this.settings.onEventMethodCall({type:"identify",options:r}),this.normalize(n.__assign(n.__assign({},this.baseEvent()),{type:"identify",userId:e,traits:t??{},options:n.__assign({},r),integrations:a}))},r.prototype.group=function(e,t,r,a){return this.settings.onEventMethodCall({type:"group",options:r}),this.normalize(n.__assign(n.__assign({},this.baseEvent()),{type:"group",traits:t??{},options:n.__assign({},r),integrations:n.__assign({},a),groupId:e}))},r.prototype.alias=function(e,t,r,a){this.settings.onEventMethodCall({type:"alias",options:r});r={userId:e,type:"alias",options:n.__assign({},r),integrations:n.__assign({},a)};return null!==t&&(r.previousId=t),void 0===e?this.normalize(n.__assign(n.__assign({},r),this.baseEvent())):this.normalize(n.__assign(n.__assign({},this.baseEvent()),r))},r.prototype.baseEvent=function(){return{integrations:{},options:{}}},r.prototype.context=function(t){var e,r=["userId","anonymousId","timestamp","messageId"],a=(delete t.integrations,Object.keys(t)),s=null!=(e=t.context)?e:{},i={};return a.forEach(function(e){"context"!==e&&(r.includes(e)?(0,o.dset)(i,e,t[e]):(0,o.dset)(s,e,t[e]))}),[s,i]},r.prototype.normalize=function(a){var e=Object.keys(null!=(e=a.integrations)?e:{}).reduce(function(e,t){var r;return n.__assign(n.__assign({},e),((e={})[t]=!(null==(r=a.integrations)||!r[t]),e))},{}),e=(a.options=(0,l.pickBy)(a.options||{},function(e,t){return void 0!==t}),n.__assign(n.__assign({},e),null==(e=a.options)?void 0:e.integrations)),t=a.options?this.context(a.options):[],r=t[0],t=t[1],s=a.options,i=n.__rest(a,["options"]),i=n.__assign(n.__assign(n.__assign(n.__assign({timestamp:new Date},i),{context:r,integrations:e}),t),{messageId:s.messageId||this.settings.createMessageId()});return this.settings.onFinishedEvent(i),(0,c.validateEvent)(i),i},e.CoreEventFactory=r}),hre=O(e=>{function a(a,s){return new Promise(function(t,e){var r=setTimeout(function(){e(Error("Promise timed out"))},s);a.then(function(e){return clearTimeout(r),t(e)}).catch(e)})}function s(t){return new Promise(function(e){return setTimeout(e,t)})}Object.defineProperty(e,"__esModule",{value:!0}),e.invokeCallback=e.sleep=e.pTimeout=void 0,e.pTimeout=a,e.sleep=s,e.invokeCallback=function(t,e,r){return s(r).then(function(){return a((()=>{try{return Promise.resolve(e(t))}catch(e){return Promise.reject(e)}})(),1e3)}).catch(function(e){t?.log("warn","Callback Error",{error:e}),t?.stats.increment("callback_error")}).then(function(){return t})}}),yCe=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createDeferred=void 0;e.createDeferred=function(){var e,t,s=!1,r=new Promise(function(r,a){e=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];s=!0,r.apply(void 0,e)},t=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];s=!0,a.apply(void 0,e)}});return{resolve:e,reject:t,promise:r,isSettled:function(){return s}}}}),ECe=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),Xl(),Qo(Jl).__exportStar(yCe(),e)}),wCe=O(e=>{function t(e){this.callbacks={},this.warned=!1,this.maxListeners=null!=(e=e?.maxListeners)?e:10}Object.defineProperty(e,"__esModule",{value:!0}),e.Emitter=void 0,t.prototype.warnIfPossibleMemoryLeak=function(e){this.warned||this.maxListeners&&this.callbacks[e].length>this.maxListeners&&(console.warn("Event Emitter: Possible memory leak detected; ".concat(String(e)," has exceeded ").concat(this.maxListeners," listeners.")),this.warned=!0)},t.prototype.on=function(e,t){return this.callbacks[e]?(this.callbacks[e].push(t),this.warnIfPossibleMemoryLeak(e)):this.callbacks[e]=[t],this},t.prototype.once=function(r,a){function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.off(r,s),a.apply(i,e)}var i=this;return this.on(r,s),this},t.prototype.off=function(e,t){var r=(null!=(r=this.callbacks[e])?r:[]).filter(function(e){return e!==t});return this.callbacks[e]=r,this},t.prototype.emit=function(e){for(var t=this,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];return(null!=(e=this.callbacks[e])?e:[]).forEach(function(e){e.apply(t,r)}),this},e.Emitter=t}),CCe=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),Xl(),Qo(Jl).__exportStar(wCe(),e)}),$_=O(e=>{Object.defineProperty(e,"__esModule",{value:!0});Xl();var t=Qo(Jl);t.__exportStar(ECe(),e),t.__exportStar(CCe(),e)}),_re=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.backoff=void 0,e.backoff=function(e){var t=Math.random()+1,r=e.minTimeout,a=e.factor,s=void 0===(s=e.maxTimeout)?1/0:s;return Math.min(t*(void 0===r?500:r)*Math.pow(void 0===a?2:a,e.attempt),s)}}),Are=O(s=>{Object.defineProperty(s,"__esModule",{value:!0}),s.PriorityQueue=s.ON_REMOVE_FROM_FUTURE=void 0;Xl();var i,e=Qo(Jl),t=$_(),n=_re(),t=(s.ON_REMOVE_FROM_FUTURE="onRemoveFromFuture",i=t.Emitter,e.__extends(r,i),r.prototype.push=function(){for(var r=this,e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var a=e.map(function(e){return!(r.updateAttempts(e)>r.maxAttempts||r.includes(e)||(r.queue.push(e),0))});return this.queue=this.queue.sort(function(e,t){return r.getAttempts(e)-r.getAttempts(t)}),a},r.prototype.pushWithBackoff=function(t,e){var r,a=this;return 0==(e=void 0===e?0:e)&&0===this.getAttempts(t)?this.push(t)[0]:!((r=this.updateAttempts(t))>this.maxAttempts||this.includes(t)||(r=(0,n.backoff)({attempt:r-1}),0<e&&r<e&&(r=e),setTimeout(function(){a.queue.push(t),a.future=a.future.filter(function(e){return e.id!==t.id}),a.emit(s.ON_REMOVE_FROM_FUTURE)},r),this.future.push(t),0))},r.prototype.getAttempts=function(e){return null!=(e=this.seen[e.id])?e:0},r.prototype.updateAttempts=function(e){return this.seen[e.id]=this.getAttempts(e)+1,this.getAttempts(e)},r.prototype.includes=function(t){return this.queue.includes(t)||this.future.includes(t)||!!this.queue.find(function(e){return e.id===t.id})||!!this.future.find(function(e){return e.id===t.id})},r.prototype.pop=function(){return this.queue.shift()},Object.defineProperty(r.prototype,"length",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"todo",{get:function(){return this.queue.length+this.future.length},enumerable:!1,configurable:!0}),r);function r(e,t,r){var a=i.call(this)||this;return a.future=[],a.maxAttempts=e,a.queue=t,a.seen=r??{},a}s.PriorityQueue=t}),bre=O(e=>{for(var a,s=256,i=[];s--;)i[s]=(s+256).toString(16).substring(1);e.v4=function(){var e,t=0,r="";if(!a||256<s+16){for(a=Array(t=256);t--;)a[t]=256*Math.random()|0;t=s=0}for(;t<16;t++)e=a[s+t],r+=6==t?i[15&e|64]:8==t?i[63&e|128]:i[e],1&t&&1<t&&t<11&&(r+="-");return s++,r}}),vre=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CoreLogger=void 0;Xl();var a=Qo(Jl);function t(){this._logs=[]}t.prototype.log=function(e,t,r){var a=new Date;this._logs.push({level:e,message:t,time:a,extras:r})},Object.defineProperty(t.prototype,"logs",{get:function(){return this._logs},enumerable:!1,configurable:!0}),t.prototype.flush=function(){var e;1<this.logs.length?(e=this._logs.reduce(function(e,t){var r=a.__assign(a.__assign({},t),{json:JSON.stringify(t.extras,null," "),extras:t.extras}),t=(delete r.time,null!=(t=null==(t=t.time)?void 0:t.toISOString())?t:"");return e[t]&&(t="".concat(t,"-").concat(Math.random())),a.__assign(a.__assign({},e),((e={})[t]=r,e))},{}),console.table?console.table(e):console.log(e)):this.logs.forEach(function(e){var t=e.level,r=e.message,e=e.extras;"info"===t||"debug"===t?console.log(r,e??""):console[t](r,e??"")}),this._logs=[]},e.CoreLogger=t}),Ere=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NullStats=e.CoreStats=void 0;Xl();var t=Qo(Jl),r=(a.prototype.increment=function(e,t,r){this.metrics.push({metric:e,value:t=void 0===t?1:t,tags:r??[],type:"counter",timestamp:Date.now()})},a.prototype.gauge=function(e,t,r){this.metrics.push({metric:e,value:t,tags:r??[],type:"gauge",timestamp:Date.now()})},a.prototype.flush=function(){var e=this.metrics.map(function(e){return t.__assign(t.__assign({},e),{tags:e.tags.join(",")})});console.table?console.table(e):console.log(e),this.metrics=[]},a.prototype.serialize=function(){return this.metrics.map(function(e){return{m:e.metric,v:e.value,t:e.tags,k:{gauge:"g",counter:"c"}[e.type],e:e.timestamp}})},a);function a(){this.metrics=[]}e.CoreStats=r;s=r,t.__extends(i,s),i.prototype.gauge=function(){for(var e=0;e<arguments.length;e++)e,0},i.prototype.increment=function(){for(var e=0;e<arguments.length;e++)e,0},i.prototype.flush=function(){for(var e=0;e<arguments.length;e++)e,0},i.prototype.serialize=function(){for(var e=0;e<arguments.length;e++)e,0;return[]};var s,r=i;function i(){return null!==s&&s.apply(this,arguments)||this}e.NullStats=r}),pB=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CoreContext=e.ContextCancelation=void 0;var s=bre(),i=lre(),n=vre(),o=Ere(),t=function(e){var t;this.retry=null==(t=e.retry)||t,this.type=null!=(t=e.type)?t:"plugin Error",this.reason=null!=(t=e.reason)?t:""},r=(e.ContextCancelation=t,a.system=function(){},a.prototype.isSame=function(e){return e.id===this.id},a.prototype.cancel=function(e){throw e||new t({reason:"Context Cancel"})},a.prototype.log=function(e,t,r){this.logger.log(e,t,r)},Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),a.prototype.updateEvent=function(e,t){var r;if("integrations"===e.split(".")[0]){var a=e.split(".")[1];if(!1===(null==(r=this.event.integrations)?void 0:r[a]))return this.event}return(0,i.dset)(this.event,e,t),this.event},a.prototype.failedDelivery=function(){return this._failedDelivery},a.prototype.setFailedDelivery=function(e){this._failedDelivery=e},a.prototype.logs=function(){return this.logger.logs},a.prototype.flush=function(){this.logger.flush(),this.stats.flush()},a.prototype.toJSON=function(){return{id:this._id,event:this.event,logs:this.logger.logs,metrics:this.stats.metrics}},a);function a(e,t,r,a){void 0===t&&(t=(0,s.v4)()),void 0===r&&(r=new o.NullStats),void 0===a&&(a=new n.CoreLogger),this.attempts=0,this.event=e,this._id=t,this.logger=a,this.stats=r}e.CoreContext=r}),DCe=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.groupBy=void 0;Xl();var i=Qo(Jl);e.groupBy=function(e,a){var s={};return e.forEach(function(e){var t,r=void 0;"string"==typeof a?r="string"!=typeof(t=e[a])?JSON.stringify(t):t:a instanceof Function&&(r=a(e)),void 0!==r&&(s[r]=i.__spreadArray(i.__spreadArray([],null!=(t=s[r])?t:[],!0),[e],!1))}),s}}),RCe=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isThenable=void 0;e.isThenable=function(e){return"object"==typeof e&&null!==e&&"then"in e&&"function"==typeof e.then}}),LCe=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createTaskGroup=void 0;var s=RCe();e.createTaskGroup=function(){var t,r,a=0;return{done:function(){return t},run:function(e){e=e();return(0,s.isThenable)(e)&&(1==++a&&(t=new Promise(function(e){return r=e})),e.finally(function(){return 0==--a&&r()})),e}}}}),Cre=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ensure=e.attempt=void 0;Xl();var s=Qo(Jl),i=pB();function r(t,r){t.log("debug","plugin",{plugin:r.name});var a=(new Date).getTime(),e=r[t.event.type];return void 0===e?Promise.resolve(t):function(r){return s.__awaiter(this,void 0,void 0,function(){var t;return s.__generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,r()];case 1:return[2,e.sent()];case 2:return t=e.sent(),[2,Promise.reject(t)];case 3:return[2]}})})}(function(){return e.apply(r,[t])}).then(function(e){var t=(new Date).getTime()-a;return e.stats.gauge("plugin_time",t,["plugin:".concat(r.name)]),e}).catch(function(e){if(e instanceof i.ContextCancelation&&"middleware_cancellation"===e.type)throw e;return e instanceof i.ContextCancelation?t.log("warn",e.type,{plugin:r.name,error:e}):(t.log("error","plugin Error",{plugin:r.name,error:e}),t.stats.increment("plugin_error",1,["plugin:".concat(r.name)])),e})}e.attempt=r,e.ensure=function(t,e){return r(t,e).then(function(e){if(e instanceof i.CoreContext)return e;t.log("debug","Context canceled"),t.stats.increment("context_canceled"),t.cancel(e)})}}),BCe=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CoreEventQueue=void 0;Xl();var r,f=Qo(Jl),i=DCe(),a=Are(),g=pB(),t=$_(),s=LCe(),m=Cre(),t=(r=t.Emitter,f.__extends(n,r),n.prototype.register=function(s,i,n){return f.__awaiter(this,void 0,void 0,function(){var t,r,a=this;return f.__generator(this,function(e){switch(e.label){case 0:return this.plugins.push(i),t=function(e){a.failedInitializations.push(i.name),a.emit("initialization_failure",i),console.warn(i.name,e),s.log("warn","Failed to load destination",{plugin:i.name,error:e}),a.plugins=a.plugins.filter(function(e){return e!==i})},"destination"===i.type&&"Segment.io"!==i.name?(i.load(s,n).catch(t),[3,4]):[3,1];case 1:return e.trys.push([1,3,,4]),[4,i.load(s,n)];case 2:return e.sent(),[3,4];case 3:return r=e.sent(),t(r),[3,4];case 4:return[2]}})})},n.prototype.deregister=function(r,a,s){return f.__awaiter(this,void 0,void 0,function(){var t;return f.__generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),a.unload?[4,Promise.resolve(a.unload(r,s))]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.plugins=this.plugins.filter(function(e){return e.name!==a.name}),[3,4];case 3:return t=e.sent(),r.log("warn","Failed to unload destination",{plugin:a.name,error:t}),[3,4];case 4:return[2]}})})},n.prototype.dispatch=function(r){return f.__awaiter(this,void 0,void 0,function(){var t;return f.__generator(this,function(e){return r.log("debug","Dispatching"),r.stats.increment("message_dispatched"),this.queue.push(r),t=this.subscribeToDelivery(r),this.scheduleFlush(0),[2,t]})})},n.prototype.subscribeToDelivery=function(i){return f.__awaiter(this,void 0,void 0,function(){var s=this;return f.__generator(this,function(e){return[2,new Promise(function(r){function a(e,t){e.isSame(i)&&(s.off("flush",a),r(e))}s.on("flush",a)})]})})},n.prototype.dispatchSingle=function(r){return f.__awaiter(this,void 0,void 0,function(){var t=this;return f.__generator(this,function(e){return r.log("debug","Dispatching"),r.stats.increment("message_dispatched"),this.queue.updateAttempts(r),r.attempts=1,[2,this.deliver(r).catch(function(e){return t.enqueuRetry(e,r)?t.subscribeToDelivery(r):(r.setFailedDelivery({reason:e}),r)})]})})},n.prototype.isEmpty=function(){return 0===this.queue.length},n.prototype.scheduleFlush=function(e){var t=this;void 0===e&&(e=500),this.flushing||(this.flushing=!0,setTimeout(function(){t.flush().then(function(){setTimeout(function(){t.flushing=!1,t.queue.length&&t.scheduleFlush(0)},0)})},e))},n.prototype.deliver=function(s){return f.__awaiter(this,void 0,void 0,function(){var t,r,a;return f.__generator(this,function(e){switch(e.label){case 0:return[4,this.criticalTasks.done()];case 1:e.sent(),t=Date.now(),e.label=2;case 2:return e.trys.push([2,4,,5]),[4,this.flushOne(s)];case 3:return s=e.sent(),r=Date.now()-t,this.emit("delivery_success",s),s.stats.gauge("delivered",r),s.log("debug","Delivered",s.event),[2,s];case 4:throw r=e.sent(),a=r,s.log("error","Failed to deliver",a),this.emit("delivery_failure",s,a),s.stats.increment("delivery_failed"),r;case 5:return[2]}})})},n.prototype.enqueuRetry=function(e,t){return!!(!(e instanceof g.ContextCancelation)||e.retry)&&this.queue.pushWithBackoff(t)},n.prototype.flush=function(){return f.__awaiter(this,void 0,void 0,function(){var t,r;return f.__generator(this,function(e){switch(e.label){case 0:if(0===this.queue.length)return[2,[]];if(!(t=this.queue.pop()))return[2,[]];t.attempts=this.queue.getAttempts(t),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.deliver(t)];case 2:return t=e.sent(),this.emit("flush",t,!0),[3,4];case 3:return r=e.sent(),this.enqueuRetry(r,t)||(t.setFailedDelivery({reason:r}),this.emit("flush",t,!1)),[2,[]];case 4:return[2,[t]]}})})},n.prototype.isReady=function(){return!0},n.prototype.availableExtensions=function(a){var e=this.plugins.filter(function(e){var t,r;return"destination"!==e.type&&"Segment.io"!==e.name||(r=void 0,null!=(t=e.alternativeNames)&&t.forEach(function(e){void 0!==a[e]&&(r=a[e])}),null!=(t=null!=(t=a[e.name])?t:r)?t:!1!==("Segment.io"===e.name||a.All))}),e=(0,i.groupBy)(e,"type"),t=e.before,r=e.enrichment,s=e.destination,e=e.after;return{before:void 0===t?[]:t,enrichment:void 0===r?[]:r,destinations:void 0===s?[]:s,after:void 0===e?[]:e}},n.prototype.flushOne=function(d){var h;return f.__awaiter(this,void 0,void 0,function(){var t,r,a,s,i,n,o,l,c,p,u;return f.__generator(this,function(e){switch(e.label){case 0:if(!this.isReady())throw new Error("Not ready");1<d.attempts&&this.emit("delivery_retry",d),t=this.availableExtensions(null!=(h=d.event.integrations)?h:{}),a=t.before,t=t.enrichment,r=0,a=a,e.label=1;case 1:return r<a.length?(s=a[r],[4,(0,m.ensure)(d,s)]):[3,4];case 2:(l=e.sent())instanceof g.CoreContext&&(d=l),this.emit("message_enriched",d,s),e.label=3;case 3:return r++,[3,1];case 4:i=0,n=t,e.label=5;case 5:return i<n.length?(o=n[i],[4,(0,m.attempt)(d,o)]):[3,8];case 6:(l=e.sent())instanceof g.CoreContext&&(d=l),this.emit("message_enriched",d,o),e.label=7;case 7:return i++,[3,5];case 8:return p=this.availableExtensions(null!=(h=d.event.integrations)?h:{}),c=p.destinations,p=p.after,[4,new Promise(function(t,r){setTimeout(function(){var e=c.map(function(e){return(0,m.attempt)(d,e)});Promise.all(e).then(t).catch(r)},0)})];case 9:return e.sent(),d.stats.increment("message_delivered"),this.emit("message_delivered",d),u=p.map(function(e){return(0,m.attempt)(d,e)}),[4,Promise.all(u)];case 10:return e.sent(),[2,d]}})})},n);function n(e){var t=r.call(this)||this;return t.criticalTasks=(0,s.createTaskGroup)(),t.plugins=[],t.failedInitializations=[],t.flushing=!1,t.queue=e,t.queue.on(a.ON_REMOVE_FROM_FUTURE,function(){t.scheduleFlush(0)}),t}e.CoreEventQueue=t}),FCe=O(e=>{Object.defineProperty(e,"__esModule",{value:!0})}),YCe=O(o=>{Object.defineProperty(o,"__esModule",{value:!0}),o.dispatch=o.getDelay=void 0;Xl();var e=Qo(Jl),l=hre();o.getDelay=function(e,t){e=Date.now()-e;return Math.max((t??300)-e,0)},o.dispatch=function(a,s,i,n){return e.__awaiter(this,void 0,void 0,function(){var t,r;return e.__generator(this,function(e){switch(e.label){case 0:return i.emit("dispatch_start",a),t=Date.now(),s.isEmpty()?[4,s.dispatchSingle(a)]:[3,2];case 1:return r=e.sent(),[3,4];case 2:return[4,s.dispatch(a)];case 3:r=e.sent(),e.label=4;case 4:return n?.callback?[4,(0,l.invokeCallback)(r,n.callback,(0,o.getDelay)(t,n.timeout))]:[3,6];case 5:r=e.sent(),e.label=6;case 6:return n?.debug&&r.flush(),[2,r]}})})}}),NCe=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.bindAll=void 0,e.bindAll=function(e){for(var t=e.constructor.prototype,r=0,a=Object.getOwnPropertyNames(t);r<a.length;r++){var s,i=a[r];"constructor"!==i&&(s=Object.getOwnPropertyDescriptor(e.constructor.prototype,i))&&"function"==typeof s.value&&(e[i]=e[i].bind(e))}return e}}),f2=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CoreLogger=e.backoff=void 0;Xl();var t=Qo(Jl),r=(t.__exportStar(sCe(),e),t.__exportStar(aCe(),e),t.__exportStar(cre(),e),t.__exportStar(ACe(),e),t.__exportStar(hre(),e),t.__exportStar(Are(),e),_re()),a=(Object.defineProperty(e,"backoff",{enumerable:!0,get:function(){return r.backoff}}),t.__exportStar(pB(),e),t.__exportStar(BCe(),e),t.__exportStar(FCe(),e),t.__exportStar(YCe(),e),t.__exportStar(dre(),e),t.__exportStar(ure(),e),t.__exportStar(fre(),e),t.__exportStar(NCe(),e),t.__exportStar(Ere(),e),vre());Object.defineProperty(e,"CoreLogger",{enumerable:!0,get:function(){return a.CoreLogger}}),t.__exportStar(Cre(),e)}),PCe=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.validateSettings=void 0;var t=f2();e.validateSettings=e=>{if(!e.writeKey)throw new t.ValidationError("writeKey","writeKey is missing.")}}),xre=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.version=void 0,e.version="2.2.1"}),$Ce=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.tryCreateFormattedUrl=void 0;e.tryCreateFormattedUrl=(e,t)=>new URL(t||"",e).href.replace(/\/$/,"")}),wB=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.uuid=void 0;var t=bre();Object.defineProperty(e,"uuid",{enumerable:!0,get:function(){return t.v4}})}),UCe=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ContextBatch=void 0;var t=wB();e.ContextBatch=class{id=(0,t.uuid)();items=[];sizeInBytes=0;maxEventCount;constructor(e){this.maxEventCount=Math.max(1,e)}tryAdd(e){var t;return this.length===this.maxEventCount?{success:!1,message:`Event limit of ${this.maxEventCount} has been exceeded.`}:32768<(t=this.calculateSize(e.context))?{success:!1,message:"Event exceeds maximum event size of 32 KB"}:491520<this.sizeInBytes+t?{success:!1,message:"Event has caused batch size to exceed 480 KB"}:(this.items.push(e),this.sizeInBytes+=t,{success:!0})}get length(){return this.items.length}calculateSize(e){return encodeURI(JSON.stringify(e.event)).split(/%..|i/).length}getEvents(){return this.items.map(({context:e})=>e.event)}getContexts(){return this.items.map(e=>e.context)}resolveEvents(){this.items.forEach(({resolver:e,context:t})=>e(t))}}}),Tre=O(e=>{Object.defineProperty(e,"__esModule",{value:!0});var r=require("crypto");e.default=(e,t)=>(0,r.createHash)(e).update(t).digest()}),ga=O(r=>{Object.defineProperty(r,"__esModule",{value:!0}),r.decoder=r.encoder=void 0,r.concat=s,r.p2s=function(e,t){return s(r.encoder.encode(e),new Uint8Array([0]),t)},r.uint64be=function(e){var t=Math.floor(e/a),e=e%a,r=new Uint8Array(8);return i(r,t,0),i(r,e,4),r},r.uint32be=o,r.lengthAndInput=function(e){return s(o(e.length),e)},r.concatKdf=async function(t,e,r){var a=Math.ceil((e>>3)/32),s=new Uint8Array(32*a);for(let e=0;e<a;e++){var i=new Uint8Array(4+t.length+r.length);i.set(o(e+1)),i.set(t,4),i.set(r,4+t.length),s.set(await(0,n.default)("sha256",i),32*e)}return s.slice(0,e>>3)};var n=Tre(),a=(r.encoder=new TextEncoder,r.decoder=new TextDecoder,2**32);function s(...e){let t=e.reduce((e,{length:t})=>e+t,0),r=new Uint8Array(t),a=0;for(var s of e)r.set(s,a),a+=s.length;return r}function i(e,t,r){if(t<0||a<=t)throw new RangeError(`value must be >= 0 and <= ${a-1}. Received `+t);e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function o(e){var t=new Uint8Array(4);return i(t,e),t}}),Zl=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.decode=e.encode=e.encodeBase64=e.decodeBase64=void 0;var t=require("buffer"),r=ga();e.encode=e=>t.Buffer.from(e).toString("base64url"),e.decodeBase64=e=>new Uint8Array(t.Buffer.from(e,"base64")),e.encodeBase64=e=>t.Buffer.from(e).toString("base64");e.decode=e=>new Uint8Array(t.Buffer.from((e=>{let t=e;return t=t instanceof Uint8Array?r.decoder.decode(t):t})(e),"base64url"))}),Ur=O(e=>{Object.defineProperty(e,"__esModule",{value:!0}),e.
